---
import { processDate } from "../lib/utils";
import { siteConfig } from "../site.config";
import type { PostFrontmatter } from "../lib/types";
import Section from "../components/common/Section.astro";
import Prose from "../components/common/Prose.astro";
import Layout from "./Layout.astro";
import SEO from "../components/common/SEO.astro";
import ContentLayoutHeader from "../components/common/ContentLayoutHeader.astro";
import DraftBox from "../components/common/DraftBox.astro";
import TableOfContents from "../components/common/TableOfContents.astro";
import SubCollectionLinks from "../components/common/SubCollectionLinks.astro"
import type { MarkdownHeading } from "astro";


import type { collections } from "../content.config";

type Props = { 
  frontmatter: PostFrontmatter; 
  headings?: MarkdownHeading[];
  collectionName: keyof typeof collections;
};

const { frontmatter, headings, collectionName } = Astro.props;
const publishDate = processDate(frontmatter.published);
const updateDate = processDate(frontmatter.updated);
const tags = frontmatter.tags;
const config = siteConfig;
const isDev = import.meta.env.DEV;
const isDraft = frontmatter.draft;
const hideTOC = frontmatter.hideTOC;
const isIndex = frontmatter.isIndex;
const indexDirectory = frontmatter.indexDirectory;
---

<Layout>
  <Fragment slot="head">
    <SEO configKey={collectionName} />
  </Fragment>
  <div class="mx-auto max-w-6xl">
    <div class="flex flex-row gap-8">
      <div class="flex-1 min-w-0">
        <Section class="pt-8">
          {isDev && isDraft && <DraftBox />}
          <ContentLayoutHeader 
            title={frontmatter.title} 
            tags={tags} 
            publishDate={publishDate} 
            updateDate={updateDate} 
          />
          <Prose class="max-w-none">
            <slot />
            {isIndex && indexDirectory && <SubCollectionLinks collectionName={collectionName} indexDirectory={indexDirectory}/>}
          </Prose>
          <p class="pt-8">- {config.personal.name}</p>
        </Section>
      </div>
      {!hideTOC && (
        <div class="hidden xl:block w-80 flex-shrink-0">
          <TableOfContents headings={headings}/>
        </div>
      )}
    </div>
  </div>
</Layout>
