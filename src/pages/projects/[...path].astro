---
import { getCollection, render } from "astro:content";
import ProjectLayout from "../../layouts/ProjectLayout.astro";
import path from "path";

export async function getStaticPaths() {
  const collection = "projects"
  const projects = await getCollection(collection);
  
  return projects.map((project) => {
    // Extract directory from entry.id (e.g., "category/project.md" or "project.md")
    const filePath = project.id;
    const dir = path.dirname(filePath); // "category" or "."
    
    // Construct full path: include directory if present, otherwise just slug
    const fullPath = dir !== '.' 
      ? `${dir}/${project.data.slug}` 
      : project.data.slug;
    
    return {
      params: { path: fullPath },
      props: { 
        project: {
          ...project,
          data: {
            ...project.data,
          },
        },
      },
    };
  });
}

const { project } = Astro.props;
const { Content, headings } = await render(project);
---

<ProjectLayout frontmatter={project.data} headings={headings}>
  <Content />
</ProjectLayout>