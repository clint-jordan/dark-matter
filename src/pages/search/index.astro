---
import Layout from "../../layouts/Layout.astro";
import Section from "../../components/common/Section.astro";
import SEO from "../../components/common/SEO.astro";
import { siteConfig } from "../../site.config"

const config = siteConfig;
const baseUrl = import.meta.env.BASE_URL;
---

<Layout>
  <Fragment slot="head">
    <SEO
      title="Search"
      titleSuffix={config.personal.name}
      description="Search through blog posts, notes, and projects"
      longDescription="Search through all content including blog posts, notes, and projects to find what you're looking for."
      keywords={["search", "blog", "notes", "projects"]}
      cardImage={config.searchMeta.cardImage}
      url={`${baseUrl}/search`}
    />
    <link rel="stylesheet" href={import.meta.env.DEV ? '/dist/pagefind/pagefind-ui.css' : `${baseUrl}/pagefind/pagefind-ui.css`}>
    <style>
      /* Custom Pagefind styling */
      :root {
        /* Search input styling */
        --pagefind-ui-scale: 1;
        --pagefind-ui-primary: green;
        --pagefind-ui-text: var(--theme-text-color, #374151);
        --pagefind-ui-background: var(--theme-bg-color, #ffffff);
        --pagefind-ui-border: var(--theme-border-color, #d1d5db);
        --pagefind-ui-tag: #e5e7eb;
        --pagefind-ui-border-width: 1px;
        --pagefind-ui-border-radius: 8px;
        --pagefind-ui-font: var(--font-mono, 'IBM Plex Mono', monospace);
        --pagefind-ui-font-size: 16px;
        --pagefind-ui-line-height: 1.5;
        --pagefind-ui-font-weight: 400;
        --pagefind-ui-font-weight-bold: 600;
        --pagefind-ui-font-weight-heading: 700;
        --pagefind-ui-letter-spacing: 0.025em;
        --pagefind-ui-spacing: 1rem;
        --pagefind-ui-spacing-xs: 0.5rem;
        --pagefind-ui-spacing-sm: 0.75rem;
        --pagefind-ui-spacing-md: 1.25rem;
        --pagefind-ui-spacing-lg: 1.5rem;
        --pagefind-ui-spacing-xl: 2rem;
        --pagefind-ui-spacing-xxl: 3rem;
        --pagefind-ui-border-radius: 8px;
        --pagefind-ui-border-width: 1px;
        --pagefind-ui-border: #d1d5db;
        --pagefind-ui-tag: #e5e7eb;
        --pagefind-ui-tag-hover: #d1d5db;
        --pagefind-ui-color: #374151;
        --pagefind-ui-background: #ffffff;
        --pagefind-ui-primary: #3b82f6;
        --pagefind-ui-secondary: #6b7280;
        --pagefind-ui-muted: #9ca3af;
        --pagefind-ui-error: #ef4444;
        --pagefind-ui-success: #10b981;
        --pagefind-ui-warning: #f59e0b;
        --pagefind-ui-info: #3b82f6;
        --pagefind-ui-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        --pagefind-ui-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      /* Dark mode support */
      @media (prefers-color-scheme: dark) {
        :root {
          --pagefind-ui-text: var(--theme-text-color, #f3f4f6);
          --pagefind-ui-background: var(--theme-bg-color, #1f2937);
          --pagefind-ui-border: var(--theme-border-color, #4b5563);
          --pagefind-ui-tag: #374151;
          --pagefind-ui-tag-hover: #4b5563;
          --pagefind-ui-color: #f3f4f6;
          --pagefind-ui-secondary: #9ca3af;
          --pagefind-ui-muted: #6b7280;
        }
      }
    </style>
  </Fragment>
  <Section class="mt-16">
    <div class="text-center mb-12">
      <h1 class="text-3xl sm:text-4xl font-display pb-4">
        Search
      </h1>
    </div>
    
    <div id="search"></div>
  </Section>
</Layout>

<script is:inline define:vars={{ baseUrl, isDev: import.meta.env.DEV }}>
  // Simple Pagefind initialization
  window.addEventListener('load', function() {
    console.log('Page loading, initializing search...');
    const script = document.createElement('script');
    script.src = isDev ? '/dist/pagefind/pagefind-ui.js' : `${baseUrl}/pagefind/pagefind-ui.js`;
    script.onload = function() {
      console.log('Pagefind UI script loaded successfully');
      const pagefindUI = new PagefindUI({
        element: "#search",
        showImages: false,
        resetStyles: false,
        translations: {
          placeholder: "Search...",
          clear_search: "Clear",
          load_more: "Load more results",
          search_result: "Search result",
          search_results: "Search results",
          search_results_for: "Search results for",
          filters: "Filters",
          filter_by: "Filter by",
          zero_results: "No results found for",
          many_results: "Found results for",
          one_result: "Found result for",
          alt_search: "No results found for. Showing results for instead",
          search_suggestion: "No results found for. Try a different search term",
          searching: "Searching for",
        }
      });

      // Add link hover classes to Pagefind result links for underline effect
      function addLinkUnderlineEffect() {
        const links = document.querySelectorAll('.pagefind-ui__result-link');
        
        links.forEach(link => {
          // Remove Pagefind's default underline styles
          link.style.setProperty('text-decoration', 'none', 'important');
          
          // Add both the base link-hover class and the specific pagefind class
          link.classList.add('link-hover', 'pagefind-link-hover');
        });
      }

      // Apply underline effect after Pagefind loads and watch for changes
      setTimeout(addLinkUnderlineEffect, 200);
      
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'childList') {
            setTimeout(addLinkUnderlineEffect, 100);
          }
        });
      });

      const searchContainer = document.getElementById('search');
      if (searchContainer) {
        observer.observe(searchContainer, { childList: true, subtree: true });
      }
    };
    script.onerror = function() {
      console.error('Failed to load Pagefind UI');
      document.getElementById('search').innerHTML = '<p class="text-center text-red-600">Failed to load search. Please refresh the page.</p>';
    };
    document.head.appendChild(script);
  });
</script>